<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>
      Understanding the Pinocchio Protocol | Onion House
    </title>
    <link rel="stylesheet" href="https://sidx04.github.io/style.css" />

    <link rel="icon" href="https://sidx04.github.io/favicon.ico" type="image/x-icon" />
    <link rel="manifest" href="https://sidx04.github.io/site.webmanifest" />

    <!-- Development version -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  </head>
  <body>
    <!-- <nav class="navigation">
        <a href="https:&#x2F;&#x2F;sidx04.github.io" >/home</a>
        <a href="https://sidx04.github.io/about" >/about</a>
        <a href="https://sidx04.github.io/posts" class="active">/posts</a>
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
            <i data-lucide="sun" class="icon-sun"></i>
            <i data-lucide="moon" class="icon-moon"></i>
        </button>
    </nav> -->

    <nav class="navigation">
      <div class="navigation-menu">
        <a href="https:&#x2F;&#x2F;sidx04.github.io" >/home</a>
        <!-- <a href="https://sidx04.github.io/about" >/about</a> -->
        <a href="https://sidx04.github.io/posts" class="active">/posts</a>
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
          <i data-lucide="sun" class="icon-sun"></i>
          <i data-lucide="moon" class="icon-moon"></i>
        </button>
      </div>
    </nav>

    <main>
<article class="post">
  <!-- Back Button -->
  <div class="back-button">
    <a href="/posts" aria-label="Back to Posts">&larr; Back to Posts</a>
  </div>

  <header class="post-header">
    <h1 class="post-title">Understanding the Pinocchio Protocol</h1>
    <div class="post-meta">
      
      <time>December 20, 2024.</time>  
    </div>
  </header>

  <div class="post-content"><h3 id="commitments-and-hidings">Commitments and Hidings</h3>
<ul>
<li>
<p><strong>Commitments</strong>: In cryptographic terms, $E(x)$ represents a "hiding" or a commitment to $x$. It's a way of locking a value $x$ such that:</p>
<ol>
<li>$x$ remains hidden (privacy), and</li>
<li>$x$ can later be verified by proving properties about it (binding).</li>
</ol>
</li>
<li>
<p><strong>Setup</strong>: There’s a trusted setup that generates randomness $s$ and scalars $\alpha_v$, $\alpha_w$, $\alpha_y$ and publishes commitments (or hidings) that allow the prover and verifier to interact without revealing $s$ or the exact details of $\alpha$-related values.</p>
</li>
<li>
<p><strong>Prover's Goal</strong>: Convince the verifier that $v(s),w(s),y(s)$ are computed correctly based on some linear combinations $v_i(s)$, $w_i(s)$, $y_i(s)$.</p>
</li>
</ul>
<hr />
<h3 id="the-issue">The Issue</h3>
<p>The problem arises because the prover has more information than the verifier initially assumes, specifically:</p>
<ol>
<li>The prover knows the verification key $E(\alpha)$, in addition to $E(\alpha_v), E(\alpha_w), E(\alpha_y)$ and all $E(v_i(s)), E(w_i(s)), E(y_i(s))$.</li>
<li>This allows the prover to <strong>inject invalid values</strong> into their commitments, bypassing the intended checks.</li>
</ol>
<p><img src="/posts/circuit.png" alt="" /></p>
<h4 id="step-1-verification-check-mechanism">Step 1: Verification Check Mechanism</h4>
<p>The verifier checks that:</p>
<ol>
<li>
<p>$V=E(v(s))$, $W=E(w(s))$, $Y=E(y(s))$ are indeed linear combinations of their respective components:
$$v(s) = a v_1(s) + b v_2(s) + c v_3(s) + d v_4(s)$$
$$w(s) = a'w_1(s) + b'w_2(s) + c'w_3(s) + d'w_4(s)$$
$$y(s) = a''y_1(s) + b''y_2(s) + c''y_3(s) + d''y_4(s)$$</p>
<p>using some coefficients $a,b,c,d$, $a',b',c',d'$, and $a'', b'', c'' ,d''$.</p>
</li>
<li>
<p>The commitments are consistent and satisfy certain cryptographic checks.</p>
</li>
</ol>
<h4 id="step-2-problem-with-independence-of-v-w-y">Step 2: Problem with Independence of $V,W,Y$</h4>
<p>The verifier has <strong>no guarantee</strong> that:</p>
<p>$$a = a', \quad b = b', \quad c = c', \quad d = d'.$$</p>
<p>This is critical because the relationship between $v(s)$, $w(s)$, $y(s)$ relies on <strong>consistent coefficients</strong> $a$, $b$, $c$ across all components. If these coefficients differ, the prover might pass the verifier's checks but construct invalid commitments.</p>
<h4 id="step-3-exploiting-the-independence">Step 3: Exploiting the Independence</h4>
<p>The prover knows $E(\alpha)$, which allows them to craft commitments $V$ and $V'$ as follows:</p>
<p>$$V = E(z)\quad V' = E(\alpha)^z = E(\alpha z).$$</p>
<p>This construction satisfies the verifier’s checks because it aligns with the structure of the evaluation key and verification key. However, $z$ might <strong>not correspond to any valid $v(s)$</strong> or the intended linear combination of $v_i(s)$.</p>
<blockquote>
<p>“And that would pass the verifier's check without being $z=v(s)$ for any linear combination $v$ of the polynomials $v_i$.”</p>
</blockquote>
<p>By exploiting this flexibility, the prover could fake valid-looking proofs that aren’t tied to $v(s)$, $w(s)$, $y(s)$ constructed in the intended way.</p>
<hr />
<h3 id="the-solution">The Solution</h3>
<p>To send all $E(v(s))$, $E(w(s))$ and $E(y(s))$, we need a trusted setup that samples random $s$, $\alpha_v$, $\alpha_w$, $\alpha_y$ and publishes:</p>
<ol>
<li>
<p><strong>Evaluation key for all $i$</strong>:
$$E(v_i(s)), \space E(\alpha_vv_i(s))$$
$$E(w_i(s)),\space E(\alpha_ww_i(s))$$
$$E(y_i(s)),\space E(\alpha_yy_i(s))$$</p>
</li>
<li>
<p><strong>Verification Key</strong>:<br />
$$E(\alpha_v),\space E(\alpha_w),\space E(\alpha_y)$$</p>
</li>
</ol>
<p>From this, the verifier can verify that indeed $E(v(s))$, $E(w(s))$, and $E(y(s))$ are linear combinations of $v_i$, $w_i$, $y_i$.</p>
<p>However, it may be <em>any</em> linear combination. (That is, we still do not know: $a = a', \space b = b', \space c = c', \space d = d'$.)</p>
<p>To solve this problem, we send:</p>
<p>$$ E(\beta(v_i(s)+w_i(s)+y_i(s))) $$</p>
<p>and generate another verification key $E(\beta)$.</p>
<p>As before, the prover obtains $c_1$, $c_2$, $c_3$, $c_4$ and uses the evaluation key to compute:</p>
<p>$$E(v(s)), \quad E(\alpha_vv(s))$$
$$E(w(s)),\quad E(\alpha_ww(s))$$
$$E(y(s)),\quad E(\alpha_yy(s))$$</p>
<p>But now, they can also check $E(\beta(v(s)+w(s)+y(s)))$.</p>
<p>Therefore, the verifier does the checks:</p>
<ol>
<li>Check that $B(V,E(\alpha_v),V')$, $B(W,E(\alpha_w),W')$, and $B(Y,E(\alpha_y),Y')$ all equal $1$.</li>
<li>Check $VWY$ using the group operation and checks that $B(VWY,E(\beta),Z)$ equals $1$.</li>
</ol>
<hr />
<h3 id="public-parameters"><strong>Public Parameters</strong></h3>
<p>These are shared between the prover and the verifier and are accessible to both:</p>
<ol>
<li>
<p><strong>Verification Key (VK)</strong>:</p>
<ul>
<li>$E(\alpha_v),\space E(\alpha_w),\space E(\alpha_y)$: Commitments to the coefficients $\alpha_v,\space\alpha_w,\space ,\alpha_y$.</li>
<li>$E(\alpha)$: A commitment to the global coefficient $\alpha$.</li>
</ul>
</li>
<li>
<p><strong>Evaluation Key (EK)</strong>:</p>
<ul>
<li>Commitments to the evaluations $$v_i(s),\space w_i(s),\space y_i(s)$$ and their scaled versions:
<ul>
<li>$E(v_i(s))$, $E(\alpha_v v_i(s))$</li>
<li>$E(w_i(s))$, $E(\alpha_w w_i(s))$</li>
<li>$E(y_i(s))$, $E(\alpha_y y_i(s))$</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Commitments Sent by the Prover</strong>:</p>
<ul>
<li>$V=E(v(s))$: Commitment to the linear combination $v(s)$.</li>
<li>$W=E(w(s)$: Commitment to the linear combination $w(s)$.</li>
<li>$Y=E(y(s))$: Commitment to the linear combination $y(s)$.</li>
</ul>
</li>
<li>
<p><strong>Cryptographic Setup</strong>:</p>
<ul>
<li>The encryption/commitment scheme (e.g., $E(x)$) and its properties are public knowledge.</li>
<li>Any cryptographic assumptions (e.g., hardness of discrete log) are public.</li>
</ul>
</li>
</ol>
<hr />
<h3 id="private-parameters"><strong>Private Parameters</strong></h3>
<p>These are either known only to the <strong>trusted setup</strong>:</p>
<ol>
<li>
<p><strong>Trusted Setup</strong>:</p>
<ul>
<li>$s$: A random secret chosen during the setup phase.</li>
<li>$\alpha_v$, $\alpha_w$, $\alpha_y$: Secret scalars used to derive the commitments in the evaluation and verification keys.</li>
</ul>
<p>The values $s$, $\alpha_v$, $\alpha_w$, $\alpha_y$ are <strong>never revealed</strong> to either the prover or the verifier. They are used only to generate the commitments (e.g., $E(\alpha_v), E(v_i(s))$).</p>
</li>
<li>
<p><strong>Prover's Private Parameters</strong>:</p>
<ul>
<li>Coefficients $a,b,c,d$: These define how $v(s),w(s),y(s)$ are constructed as linear combinations of $v_i(s)$, $w_i(s),$ $y_i(s)$.</li>
<li>For example: $v(s) = a v_1(s) + b v_2(s) + c v_3(s) + d v_4$.</li>
<li>$v(s),w(s),y(s)$: Actual values of the linear combinations.</li>
</ul>
</li>
</ol>
<hr />
<h3 id="inputs-and-outputs">Inputs and Outputs</h3>
<p>Prover has to use inputs $c_1$, $c_2$ as provided by the verifier.</p>
<p>How to check so?</p>
<p>Recall that the verifier expects a proof of execution of the circuit on inputs $c_1$, $c_2$. Prover executes the circuit, obtains output $c_3$, and sends it to the verifier.</p>
<p>That's all!</p>
</div>

  <div class="back-button">
    <a href="/posts" aria-label="Back to Posts">&larr; Go Back </a>
  </div>
</article>
</main>
    <footer>
      <div class="footer">&copy; 2024, Siddhartha.</div>
    </footer>

    <script src="/scripts/theme.js"></script>
    <script>
      MathJax = {
        tex: {
          inlineMath: [
            ["$", "$"],
            ["\\(", "\\)"],
          ],
          displayMath: [
            ["$$", "$$"],
            ["\\[", "\\]"],
          ],
        },
        svg: {
          fontCache: "global",
        },
      };
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
      async
    ></script>
  </body>
</html>
